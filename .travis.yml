language: ruby
dist: trusty
rvm:
 - 2.3.3
# Cache bundler dependencies and phantomjs binary
cache: bundler
# For testing mongoid integration
services:
  - mongodb
# Test both integrations
env:
  - ATTACHINARY_ORM=active_record
  - ATTACHINARY_ORM=mongoid
# Headless test setup
before_install:
   - mkdir -p travis-phantomjs21
   - if [ ! -f $PWD/travis-phantomjs21/phantomjs ]; then wget https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-2.1.1-linux-x86_64.tar.bz2 -O $PWD/phantomjs-2.1-linux-x86_64.tar.bz2; tar -xvf $PWD/phantomjs-2.1-linux-x86_64.tar.bz2 -C $PWD/travis-phantomjs21 --strip-components 2 phantomjs-2.1.1-linux-x86_64/bin/phantomjs; fi
   - chmod +x $PWD/travis-phantomjs21/phantomjs
   - sudo mv $PWD/travis-phantomjs21/phantomjs /usr/local/bin/
# Copy sample credentials to expected path
before_script:
  - which phantomjs
  - ${PHANTOMJS:-phantomjs} --version
  - cp spec/support/cloudinary-sample-credentials.yml spec/dummy/config/cloudinary.yml
  - bundle exec rake db:setup
# Run RSpec
script:
  bundle exec rake
